# Rule JSON Specification (Detailed)

## Purpose

Defines the exact JSON schema used by the State Engine to generate suggestions.

Rules are **data**, not code.

---

## Rule Storage

```
/knowledge/rules/<rule-id>.json
```

One rule per file.

---

## Full Rule Schema

```json
{
  "id": "ENUM-HTTP-001",
  "title": "Enumerate HTTP Services",
  "description": "Suggest HTTP enumeration techniques when a web service is detected",
  "phase": "enumeration",
  "owasp": ["WSTG-CONF", "WSTG-INPV"],
  "conditions": {
    "services": ["HTTP", "HTTPS"],
    "ports": [80, 443],
    "tags": [],
    "min_ports": 0,
    "min_findings": 0
  },
  "suggestions": [
    {
      "type": "technique",
      "ref": "technique.http.content-discovery",
      "priority": 90
    }
  ],
  "confidence": "high"
}
```

---

## Field Definitions

### id

* Unique identifier
* Stable across versions
* Naming: `<PHASE>-<SUBJECT>-<NUMBER>`

### phase

Valid values:

* `recon`
* `enumeration`
* `exploitation`
* `post-exploitation`

Rule only evaluates when engagement is in this phase.

---

### owasp

* OWASP WSTG category IDs
* Used for reporting & traceability

---

## Conditions Object

```json
"conditions": {
  "services": [],
  "ports": [],
  "tags": [],
  "min_ports": 0,
  "min_findings": 0
}
```

### Condition Logic (MVP)

* Logical AND
* Empty arrays ignored
* Numeric fields act as thresholds

---

## Suggestions Object

```json
{
  "type": "technique | note | warning",
  "ref": "knowledge_entry_id",
  "priority": 0
}
```

### priority

* Integer 0â€“100
* Used for ordering

---

## Safety Rules

* Rules never mutate engagement data
* Rules never execute tools
* Rules never imply vulnerability

---

## Extensibility (Post-MVP)

* OR / NOT conditions
* Time-based suppression
* Custom methodologies
* MITRE ATT&CK mapping
