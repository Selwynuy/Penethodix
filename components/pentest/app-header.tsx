"use client"

import { Shield, Cloud, CloudOff, RefreshCw } from "lucide-react"
import { Badge } from "@/components/ui/badge"
import { GuidePopup } from "@/components/pentest/guide-popup"
import { useEngagementContext } from "@/contexts/engagement-context"

interface AppHeaderProps {
  syncStatus: "synced" | "syncing" | "offline"
}

const phaseLabels: Record<string, string> = {
  reconnaissance: "Recon",
  enumeration: "Enum",
  exploitation: "Exploit",
  "post-exploitation": "Post-Exploit",
  reporting: "Report",
}

const phaseColors: Record<string, string> = {
  reconnaissance: "bg-primary/20 text-primary",
  enumeration: "bg-warning/20 text-warning",
  exploitation: "bg-destructive/20 text-destructive",
  "post-exploitation": "bg-success/20 text-success",
  reporting: "bg-muted text-muted-foreground",
}

export function AppHeader({ syncStatus }: AppHeaderProps) {
  const { activeEngagement } = useEngagementContext()

  return (
    <header className="flex h-12 shrink-0 items-center justify-between border-b border-border bg-card px-4">
      <div className="flex items-center gap-3">
        <div className="flex items-center gap-2">
          <Shield className="h-5 w-5 text-primary" />
          <span className="font-semibold text-sm">Pentest Notebook</span>
        </div>
        <GuidePopup />
      </div>

      <div className="flex items-center gap-2">
        {activeEngagement ? (
          <span className="text-sm text-muted-foreground">
            {activeEngagement.name}
          </span>
        ) : (
          <span className="text-sm text-muted-foreground">No engagement selected</span>
        )}
      </div>

      <div className="flex items-center gap-3">
        {activeEngagement && (
          <Badge 
            variant="secondary" 
            className={`${phaseColors[activeEngagement.phase]} border-0 font-mono text-xs`}
          >
            {phaseLabels[activeEngagement.phase]}
          </Badge>
        )}
        
        <div className="flex items-center gap-1.5 text-muted-foreground">
          {syncStatus === "synced" && (
            <>
              <Cloud className="h-4 w-4 text-success" />
              <span className="text-xs">Synced</span>
            </>
          )}
          {syncStatus === "syncing" && (
            <>
              <RefreshCw className="h-4 w-4 animate-spin text-primary" />
              <span className="text-xs">Syncing</span>
            </>
          )}
          {syncStatus === "offline" && (
            <>
              <CloudOff className="h-4 w-4 text-warning" />
              <span className="text-xs">Offline</span>
            </>
          )}
        </div>
      </div>
    </header>
  )
}
