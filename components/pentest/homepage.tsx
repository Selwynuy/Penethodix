"use client"

import { Shield, Target, FileText, Lightbulb, BookOpen, Zap, ArrowRight, Plus, Minus, HelpCircle, ChevronDown } from "lucide-react"
import { Button } from "@/components/ui/button"
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from "@/components/ui/card"
import { AppHeader } from "@/components/pentest/app-header"
import { useState } from "react"
import { useAuth } from "@/contexts/auth-context"
import { useRouter } from "next/navigation"

interface HomepageProps {
  onCreateEngagement: () => void
  syncStatus?: "synced" | "syncing" | "offline"
  onNavigateToEngagements?: () => void
}

export function Homepage({ onCreateEngagement, syncStatus = "synced", onNavigateToEngagements }: HomepageProps) {
  const [openFaq, setOpenFaq] = useState<number | null>(null)
  const { isAuthenticated } = useAuth()
  const router = useRouter()

  const handleGetStarted = () => {
    if (isAuthenticated) {
      onCreateEngagement()
    } else {
      router.push("/auth/login")
    }
  }

  const features = [
    {
      icon: Target,
      title: "Phase-Aware Tracking",
      description: "Switch between recon, exploitation, and reporting phases. Your targets, findings, and suggestions adapt automatically to where you are in the engagement.",
    },
    {
      icon: FileText,
      title: "Structured Findings",
      description: "Document vulnerabilities with severity ratings, CVSS scores, and rich markdown. Export to reports or share with your team without reformatting.",
    },
    {
      icon: Lightbulb,
      title: "Context-Aware Suggestions",
      description: "Detected an open port or service? Get instant technique recommendations based on your custom rules and current engagement phase.",
    },
    {
      icon: BookOpen,
      title: "Hierarchical Knowledge Base",
      description: "Build your personal methodology library with nested categories. Search, filter by phase, and reference entries while working on targets.",
    },
    {
      icon: Shield,
      title: "Custom Rule Engine",
      description: "Define \"if service X on port Y in phase Z, then suggest technique A.\" Automate your workflow without writing scripts.",
    },
    {
      icon: Zap,
      title: "Real-Time Collaboration",
      description: "Work with your team on the same engagement. Changes sync instantly. No merge conflicts, no lost work, no emailing files back and forth.",
    },
  ]

  const faqs = [
    {
      question: "What makes Penethodix different from other note-taking tools?",
      answer: "Penethodix is phase-aware. It tracks where you are in your engagement (recon, exploitation, etc.) and provides contextual suggestions based on your targets, services, and current phase. No generic markdown editor does this.",
    },
    {
      question: "How does the intelligent suggestion system work?",
      answer: "You define custom rules based on detected services, open ports, or engagement phase. When conditions match, Penethodix automatically suggests relevant techniques, commands, or next steps from your knowledge base.",
    },
    {
      question: "Can I organize my knowledge base like CherryTree?",
      answer: "Yes! The knowledge base supports hierarchical categories with unlimited nesting. Create folders within folders, organize by technique type, MITRE ATT&CK, or any structure that fits your workflow.",
    },
    {
      question: "Does it support team collaboration?",
      answer: "Absolutely. Real-time sync means multiple pentesters can work on the same engagement simultaneously. See changes as they happen, share knowledge base entries, and collaborate without conflicts.",
    },
    {
      question: "Can I customize phases beyond the defaults?",
      answer: "Yes! Create custom phases that match your methodology—whether it's PTES, OWASP, OSSTMM, or your own framework. Each phase can have its own rules and knowledge base filtering.",
    },
    {
      question: "What about data security and privacy?",
      answer: "All data is encrypted in transit (TLS) and at rest. Row-level security ensures you only see your engagements. We use Supabase with industry-standard security practices built in.",
    },
  ]

  return (
    <div className="flex min-h-screen flex-col">
      {/* Navbar */}
      <AppHeader
        syncStatus={syncStatus}
        minimal={true}
        onLogoClick={() => {
          // Already on homepage, scroll to top
          window.scrollTo({ top: 0, behavior: "smooth" })
        }}
        onNavigateToEngagements={onNavigateToEngagements}
      />

      {/* Hero Section with gradient background */}
      <div className="relative overflow-visible bg-gradient-to-br from-background via-primary/10 to-primary/5 px-4 pb-0 pt-20 sm:pt-24">
        {/* Radial gradient overlay for depth */}
        <div className="pointer-events-none absolute inset-0 bg-[radial-gradient(circle_at_50%_50%,var(--primary)/0.05_0px,transparent_50%)]" />
        {/* Animated gradient orbs */}
        <div className="pointer-events-none absolute top-1/4 left-1/4 h-96 w-96 rounded-full bg-primary/10 blur-3xl" />
        <div className="pointer-events-none absolute bottom-1/4 right-1/4 h-96 w-96 rounded-full bg-primary/5 blur-3xl" />
        
        <div className="relative z-20 mx-auto max-w-4xl pb-20 text-center"> 
          <h1 className="mb-6 text-5xl font-bold tracking-tight text-foreground sm:text-6xl md:text-7xl">
            Your Pentest Notebook,
            <br />
            <span className="bg-gradient-to-r from-primary to-primary/70 bg-clip-text text-transparent">
              Supercharged
            </span>
          </h1>
          
          <p className="mx-auto mb-10 max-w-2xl text-lg leading-relaxed text-muted-foreground sm:text-xl">
            Stop juggling spreadsheets and text files. Penethodix gives you phase-aware tracking, intelligent suggestions, and a hierarchical knowledge base—all synced in real-time.
          </p>

          <div className="flex flex-col items-center gap-4 sm:flex-row sm:justify-center">
            <Button
              size="lg"
              onClick={handleGetStarted}
              className="relative z-30 px-8 text-base font-semibold"
            >
              {isAuthenticated ? "Create Your First Engagement" : "Get Started - Sign In"}
            </Button>
          </div>
        </div>

        {/* Preview mockup area - positioned to overlap with next section */}
        <div className="relative z-10 mx-auto -mb-40 max-w-6xl px-4 sm:-mb-60">
          <div className="rounded-xl border border-border bg-card/80 p-3 shadow-2xl backdrop-blur-sm sm:p-4">
            {/* Browser window frame */}
            <div className="rounded-lg border border-border bg-background shadow-xl overflow-hidden">
              {/* Browser chrome */}
              <div className="flex items-center gap-2 border-b border-border bg-muted/30 px-4 py-2.5">
                <div className="flex gap-1.5">
                  <div className="h-3 w-3 rounded-full bg-red-500/80"></div>
                  <div className="h-3 w-3 rounded-full bg-yellow-500/80"></div>
                  <div className="h-3 w-3 rounded-full bg-green-500/80"></div>
                </div>
                <div className="flex-1 mx-4 rounded bg-background/50 px-3 py-1 text-xs text-muted-foreground text-center">
                  penethodix.app
                </div>
              </div>
              {/* Screenshot */}
              <div className="overflow-hidden bg-background">
                <img
                  src="/penethodix.vercel.app_.png"
                  alt="Penethodix Engagement Panel Preview"
                  className="w-full h-auto object-cover"
                />
              </div>
            </div>
          </div>
        </div>
      </div>

      {/* Built for Pentesters Section */}
      <div id="features" className="relative bg-background px-4 pb-20 pt-48 sm:pt-72">
        <div className="mx-auto max-w-6xl">
          <div className="mb-16 text-center">
            <h2 className="mb-4 text-4xl font-bold tracking-tight text-foreground">
              Everything You Need,
              <br />
              Nothing You Don't
            </h2>
            <p className="mx-auto max-w-2xl text-lg leading-relaxed text-muted-foreground">
              From reconnaissance to reporting, Penethodix adapts to your methodology. Track targets, document findings, build your knowledge base, and get intelligent next-step suggestions—all in one place.
            </p>
          </div>

          <div className="grid gap-6 md:grid-cols-2 lg:grid-cols-3">
            {features.map((feature) => {
              const Icon = feature.icon
              return (
                <div
                  key={feature.title}
                  className="group rounded-lg border border-border bg-card/50 p-6 transition-all hover:border-primary/50 hover:bg-card"
                >
                  <div className="mb-4 flex h-12 w-12 items-center justify-center rounded-lg bg-primary/10 group-hover:bg-primary/20">
                    <Icon className="h-6 w-6 text-primary" />
                  </div>
                  <h3 className="mb-2 text-lg font-semibold text-foreground">{feature.title}</h3>
                  <p className="text-sm leading-relaxed text-muted-foreground">
                    {feature.description}
                  </p>
                </div>
              )
            })}
          </div>
        </div>
      </div>

      {/* FAQ Section */}
      <div className="bg-background px-4 py-20">
        <div className="mx-auto max-w-6xl">
          <div className="mb-16 text-center">
            <h2 className="mb-4 text-4xl font-bold tracking-tight text-foreground sm:text-5xl">
              Frequently Asked <span className="text-primary">Questions</span>
            </h2>
            <p className="text-lg text-muted-foreground">
              Everything you need to know about Penethodix
            </p>
          </div>

          <div className="grid gap-4 md:grid-cols-2">
            {faqs.map((faq, index) => (
              <button
                key={index}
                onClick={() => setOpenFaq(openFaq === index ? null : index)}
                className="group rounded-xl border border-border bg-card/30 p-5 text-left transition-all hover:border-primary/50 hover:bg-card/50"
              >
                <div className="flex items-start gap-4">
                  <div className="flex h-10 w-10 shrink-0 items-center justify-center rounded-full border border-border bg-secondary/50">
                    <HelpCircle className="h-5 w-5 text-muted-foreground" />
                  </div>
                  <div className="flex-1">
                    <div className="flex items-start justify-between gap-3">
                      <h3 className="font-semibold text-foreground transition-colors group-hover:text-foreground">
                        {faq.question}
                      </h3>
                      <ChevronDown
                        className={`h-5 w-5 shrink-0 text-muted-foreground transition-transform ${
                          openFaq === index ? "rotate-180" : ""
                        }`}
                      />
                    </div>
                    {openFaq === index && (
                      <p className="mt-3 pr-8 text-sm leading-relaxed text-muted-foreground">
                        {faq.answer}
                      </p>
                    )}
                  </div>
                </div>
              </button>
            ))}
          </div>

          {/* Still have questions CTA */}
          <div className="mt-16 text-center">
            <p className="mb-4 text-muted-foreground">Still have questions?</p>
            <Button variant="outline">
              Check the Documentation
            </Button>
          </div>
        </div>
      </div>

      {/* CTA Section */}
      <div className="relative overflow-hidden bg-gradient-to-br from-background via-primary/10 to-primary/5 px-4 py-24">
        {/* Radial gradient overlay */}
        <div className="pointer-events-none absolute inset-0 bg-[radial-gradient(circle_at_50%_50%,var(--primary)/0.05_0px,transparent_50%)]" />
        {/* Subtle gradient orbs */}
        <div className="pointer-events-none absolute top-1/3 left-1/3 h-80 w-80 rounded-full bg-primary/8 blur-3xl" />
        <div className="pointer-events-none absolute bottom-1/3 right-1/3 h-80 w-80 rounded-full bg-primary/5 blur-3xl" />
        
        <div className="relative z-10 mx-auto max-w-3xl text-center">
          <h2 className="mb-6 text-4xl font-bold tracking-tight text-foreground sm:text-5xl">
            Ready to Level Up
            <br />
            Your Pentesting?
          </h2>
          <p className="mb-10 text-lg leading-relaxed text-muted-foreground">
            Join security professionals who are ditching scattered notes and embracing a smarter way to manage penetration testing engagements.
          </p>
          <Button
            size="lg"
            onClick={handleGetStarted}
            className="px-8 text-base font-semibold"
          >
            {isAuthenticated ? "Get Started Free" : "Sign In to Get Started"}
          </Button>
        </div>
      </div>

      {/* Footer */}
      <footer className="border-t border-border bg-background px-4 py-12">
        <div className="mx-auto max-w-6xl">
          <div className="grid gap-8 md:grid-cols-4">
            {/* Brand */}
            <div className="space-y-4">
              <div className="flex items-center gap-2">
                <div className="rounded-lg bg-primary/10 p-2">
                  <Shield className="h-5 w-5 text-primary" />
                </div>
                <span className="text-lg font-semibold text-foreground">Penethodix</span>
              </div>
              <p className="text-sm text-muted-foreground">
                A phase-aware penetration testing notebook with intelligent suggestions and real-time collaboration.
              </p>
            </div>

            {/* Product */}
            <div>
              <h3 className="mb-4 text-sm font-semibold text-foreground">Product</h3>
              <ul className="space-y-2 text-sm text-muted-foreground">
                <li>
                  <a href="#features" className="transition-colors hover:text-primary">
                    Features
                  </a>
                </li>
                <li>
                  <a href="#" className="transition-colors hover:text-primary">
                    Documentation
                  </a>
                </li>
                <li>
                  <a href="#" className="transition-colors hover:text-primary">
                    Changelog
                  </a>
                </li>
              </ul>
            </div>

            {/* Resources */}
            <div>
              <h3 className="mb-4 text-sm font-semibold text-foreground">Resources</h3>
              <ul className="space-y-2 text-sm text-muted-foreground">
                <li>
                  <a href="#" className="transition-colors hover:text-primary">
                    Support
                  </a>
                </li>
                <li>
                  <a href="#" className="transition-colors hover:text-primary">
                    Community
                  </a>
                </li>
                <li>
                  <a href="#" className="transition-colors hover:text-primary">
                    Blog
                  </a>
                </li>
              </ul>
            </div>

            {/* Legal */}
            <div>
              <h3 className="mb-4 text-sm font-semibold text-foreground">Legal</h3>
              <ul className="space-y-2 text-sm text-muted-foreground">
                <li>
                  <a href="#" className="transition-colors hover:text-primary">
                    Privacy Policy
                  </a>
                </li>
                <li>
                  <a href="#" className="transition-colors hover:text-primary">
                    Terms of Service
                  </a>
                </li>
                <li>
                  <a href="#" className="transition-colors hover:text-primary">
                    Security
                  </a>
                </li>
              </ul>
            </div>
          </div>

          <div className="mt-12 border-t border-border pt-8">
            <div className="flex flex-col items-center justify-between gap-4 sm:flex-row">
              <p className="text-sm text-muted-foreground">
                © {new Date().getFullYear()} Penethodix. All rights reserved.
              </p>
              <div className="flex gap-6 text-sm text-muted-foreground">
                <a href="#" className="transition-colors hover:text-primary">
                  Twitter
                </a>
                <a href="#" className="transition-colors hover:text-primary">
                  GitHub
                </a>
                <a href="#" className="transition-colors hover:text-primary">
                  LinkedIn
                </a>
              </div>
            </div>
          </div>
        </div>
      </footer>
    </div>
  )
}
